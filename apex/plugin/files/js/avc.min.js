var avc={gAvcSocket:null,gAjaxIdentifier:null,gPlgFilePrefix:null,connectWebsocket:function(e,t,a,n){var o=$v("pInstance"),r="username="+a.toLowerCase()+"&serverKey="+t+"&userAccessToken="+n+"&apexSessionId="+o;apex.debug.log("avc.connectWebsocket - connectString",r),avc.gAvcSocket=io.connect(e+"/avc",{query:r})},handleWebsocket:function(e,t){var a="",n=$v("pInstance");avc.gAvcSocket.on("message",function(o){if(apex.debug.log("avc.handleWebsocket - message data",o),apex.event.trigger("body","avc-websocket-message",o),"NAV_TO_PAGE"==o.type&&o.pageId)apex.event.trigger("body","avc-websocket-message-nav_to_page",o),"Y"==t&&(a="f?p="+$v("pFlowId")+":"+o.pageId+":"+n+":::::",avc.getProperUrl(a,e,function(e){apex.navigation.redirect(e)}));else if("NAV_TO_PAGE_SEARCH"==o.type&&o.pageId)apex.event.trigger("body","avc-websocket-message-nav_to_page_search",o),"Y"==t&&(a="f?p="+$v("pFlowId")+":"+o.pageId+":"+n+":::"+o.searchParam+o.searchValue,avc.getProperUrl(a,e,function(e){apex.navigation.redirect(e)}));else if("CURRENT_PAGE_SEARCH"==o.type&&o.pages){if(apex.event.trigger("body","avc-websocket-message-current_page_search",o),"Y"==t)for(var r=o.pages,c=0;c<r.length;c++)if(r[c].pageId==parseInt($v("pFlowStepId"))){var i=r[c].searchField;$("#"+i).val(o.searchValue),$("#"+i).hasClass("a-IRR-search-field")&&$("#"+i).parents(".a-IRR-search").find(".a-IRR-button--search").click()}}else"PARTY_MODE"==o.type&&(apex.event.trigger("body","avc-websocket-message-party_mode",o),"Y"==t&&avc.partyMode())}),avc.gAvcSocket.on("disconnect",function(){apex.debug.log("avc.handleWebsocket - websocket disconnected"),apex.event.trigger("body","avc-websocket-disconnect")})},getProperUrl:function(e,t,a){"Y"==t?apex.server.plugin(avc.gAjaxIdentifier,{x01:e},{dataType:"json",success:function(t){apex.debug.log("avc.getProperUrl - AJAX success",t),a(t.success?t.url:e)},error:function(t,n){apex.debug.log("avc.getProperUrl - AJAX error",n),a(e)}}):a(e)},partyMode:function(){!function(){function e(){var e=document.createElement("link");e.setAttribute("type","text/css"),e.setAttribute("rel","stylesheet"),e.setAttribute("href",k),e.setAttribute("class",A),document.body.appendChild(e)}function t(){for(var e=document.getElementsByClassName(A),t=0;t<e.length;t++)document.body.removeChild(e[t])}function a(){var e=document.createElement("div");e.setAttribute("class",w),document.body.appendChild(e),setTimeout(function(){document.body.removeChild(e)},100)}function n(e){return{height:e.offsetHeight,width:e.offsetWidth}}function o(e){var t=n(e);return t.height>p&&t.height<f&&t.width>v&&t.width<m}function r(e){for(var t=0;e;)t+=e.offsetTop,e=e.offsetParent;return t}function c(){var e=document.documentElement;return window.innerWidth?window.innerHeight:e&&!isNaN(e.clientHeight)?e.clientHeight:0}function i(){return window.pageYOffset?window.pageYOffset:Math.max(document.documentElement.scrollTop,document.body.scrollTop)}function s(e){var t=r(e);return t>=P&&t<=_+P}function l(){var e=document.createElement("audio");e.setAttribute("class",A),e.src=h,e.loop=!1,e.innerHTML=" <p>If you are reading this, it is because your browser does not support the audio element. We recommend that you get a new browser.</p>",document.body.appendChild(e),e.addEventListener("ended",function(){g(),t()},!0),e.addEventListener("canplay",function(){setTimeout(function(){d(E)},500),setTimeout(function(){g(),a();for(var e=0;e<C.length;e++)u(C[e])},15500)},!0),e.play()}function d(e){e.className+=" "+b+" "+x}function u(e){e.className+=" "+b+" "+y[Math.floor(Math.random()*y.length)]}function g(){for(var e=document.getElementsByClassName(b),t=new RegExp("\\b"+b+"\\b"),a=0;a<e.length;)e[a].className=e[a].className.replace(t,"")}for(var p=30,v=30,f=350,m=350,h=avc.gPlgFilePrefix+"misc/harlem-shake.mp3",b="mw-harlem_shake_me",x="im_first",y=["im_drunk","im_baked","im_trippin","im_blown"],w="mw-strobe_light",k=avc.gPlgFilePrefix+"css/harlem-shake-style.min.css",A="mw_added_css",_=c(),P=i(),I=document.getElementsByTagName("*"),E=null,H=0;H<I.length;H++){var T=I[H];if(o(T)&&s(T)){E=T;break}}if(null===E)return void apex.debug.log("Could not find a node of the right size. Please try a different page.");apex.debug.log("Found start element: ",T," with width "+n(T).width+", height "+n(T).height+", and a total Y offset of "+r(T)),e(),l();for(var C=[],H=0;H<I.length;H++){var T=I[H];o(T)&&C.push(T)}}()},pluginHandler:function(){var e=this,t=avc.gAjaxIdentifier=e.action.ajaxIdentifier,a=e.action.attribute01,n=e.action.attribute02,o=e.action.attribute03,r=e.action.attribute04,c=e.action.attribute05,i=e.action.attribute06,s=avc.gPlgFilePrefix=e.action.attribute07;apex.debug.log("avc.pluginHandler - ajaxIdentifier",t),apex.debug.log("avc.pluginHandler - baseUrl",a),apex.debug.log("avc.pluginHandler - serverKey",n),apex.debug.log("avc.pluginHandler - username",o),apex.debug.log("avc.pluginHandler - userAccessToken",r),apex.debug.log("avc.pluginHandler - enableDefaultActions",c),apex.debug.log("avc.pluginHandler - allowSSPUrl",i),apex.debug.log("avc.pluginHandler - plgFilePrefix",s),avc.connectWebsocket(a,n,o,r),avc.handleWebsocket(i,c)}};